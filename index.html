<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å½©/é‹å½© æ™ºæ…§çµå¸³ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --primary-color: #e63946; --bg-color: #f8f9fa; }
        body { background-color: var(--bg-color); font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; }
        .card { border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        .card-header { background-color: white; border-bottom: 1px solid #eee; font-weight: bold; color: var(--primary-color); }
        .real-time-panel { position: sticky; bottom: 0; background: white; border-top: 2px solid var(--primary-color); padding: 15px; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); z-index: 1000; }
        .diff-box { font-size: 1.5rem; font-weight: 800; }
        .unit-label { font-size: 0.85rem; color: #666; }
    </style>
</head>
<body>

<div class="container py-4 mb-5">
    <h3 class="text-center mb-4">ğŸ† åº—å®¶æ‰“çƒŠçµå¸³ç³»çµ±</h3>

    <form id="payForm">
        <div class="card">
            <div class="card-header">åŸºæœ¬è³‡è¨Š</div>
            <div class="card-body row g-2">
                <div class="col-6"><label>æ—¥æœŸ</label><input type="date" name="date" class="form-control" id="todayDate"></div>
                <div class="col-6"><label>çµå¸³äºº</label><input type="text" name="staff" class="form-control" placeholder="å§“å"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ğŸ’ å°ç£å½©åˆ¸ (é›»è…¦å‹)</div>
            <div class="card-body row g-2">
                <div class="col-6"><label>éŠ·å”®é¡</label><input type="number" name="lottoSales" class="form-control calc" value="0"></div>
                <div class="col-6"><label>ä½œå»¢é¡</label><input type="number" name="lottoVoid" class="form-control calc" value="0"></div>
                <div class="col-6"><label>åº—å…§å…Œç</label><input type="number" name="lottoPayoutIn" class="form-control calc" value="0"></div>
                <div class="col-6"><label>è·¨åº—å…Œç</label><input type="number" name="lottoPayoutOut" class="form-control calc" value="0"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ğŸŸï¸ åˆ®åˆ®æ¨‚ (ä¾é¢é¡å¡«å¯«éŠ·å”®å¼µæ•¸)</div>
            <div class="card-body">
                <div class="row g-2 text-center mb-3">
                    <div class="col-4"><span class="unit-label">2000å…ƒ</span><input type="number" data-price="2000" class="form-control sc-calc" value="0"></div>
                    <div class="col-4"><span class="unit-label">1000å…ƒ</span><input type="number" data-price="1000" class="form-control sc-calc" value="0"></div>
                    <div class="col-4"><span class="unit-label">500å…ƒ</span><input type="number" data-price="500" class="form-control sc-calc" value="0"></div>
                    <div class="col-4"><span class="unit-label">300å…ƒ</span><input type="number" data-price="300" class="form-control sc-calc" value="0"></div>
                    <div class="col-4"><span class="unit-label">200å…ƒ</span><input type="number" data-price="200" class="form-control sc-calc" value="0"></div>
                    <div class="col-4"><span class="unit-label">100å…ƒ</span><input type="number" data-price="100" class="form-control sc-calc" value="0"></div>
                </div>
                <hr>
                <div class="row g-2">
                    <div class="col-6"><label>åˆ®åˆ®æ¨‚ç¸½éŠ·</label><input type="number" name="scratchSales" id="scTotal" class="form-control bg-light" readonly value="0"></div>
                    <div class="col-6"><label>åˆ®åˆ®æ¨‚å…Œç</label><input type="number" name="scratchPayout" class="form-control calc" value="0"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">âš½ é‹å‹•å½©åˆ¸</div>
            <div class="card-body row g-2">
                <div class="col-6"><label>å¯¦é«”éŠ·å”®</label><input type="number" name="sportSales" class="form-control calc" value="0"></div>
                <div class="col-6"><label>ä½œå»¢é¡</label><input type="number" name="sportVoid" class="form-control calc" value="0"></div>
                <div class="col-6"><label>ä¸­çå…Œä»˜</label><input type="number" name="sportPayout" class="form-control calc" value="0"></div>
                <div class="col-6"><label>æœƒå“¡å„²å€¼</label><input type="number" name="memberIn" class="form-control calc" value="0"></div>
                <div class="col-6"><label>æœƒå“¡å‡ºé‡‘</label><input type="number" name="memberOut" class="form-control calc" value="0"></div>
                <div class="col-6"><label>è™›æ“¬æ¥­ç¸¾</label><input type="number" name="sportVirtual" class="form-control" value="0"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ğŸ’µ ç¾å ´ç¾é‡‘æ¸…é»</div>
            <div class="card-body row g-2">
                <div class="col-4"><span class="unit-label">1000å…ƒ</span><input type="number" data-cash="1000" class="form-control cash-calc" value="0"></div>
                <div class="col-4"><span class="unit-label">500å…ƒ</span><input type="number" data-cash="500" class="form-control cash-calc" value="0"></div>
                <div class="col-4"><span class="unit-label">100å…ƒ</span><input type="number" data-cash="100" class="form-control cash-calc" value="0"></div>
                <div class="col-4"><span class="unit-label">50å…ƒ</span><input type="number" data-cash="50" class="form-control cash-calc" value="0"></div>
                <div class="col-4"><span class="unit-label">10å…ƒ</span><input type="number" data-cash="10" class="form-control cash-calc" value="0"></div>
                <div class="col-4"><span class="unit-label">5å…ƒ/1å…ƒ</span><input type="number" id="smallChange" class="form-control cash-calc-manual" value="0"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <label>å‚™è¨»</label>
                <textarea name="memo" class="form-control" rows="2"></textarea>
            </div>
        </div>

        <button type="button" onclick="submitData()" class="btn btn-danger btn-lg w-100 mb-5">ç¢ºèªä¸Šå‚³è³‡æ–™</button>
    </form>
</div>

<div class="real-time-panel">
    <div class="container">
        <div class="row text-center">
            <div class="col-4 border-end">
                <div class="unit-label">æ‡‰æœ‰ç¾é‡‘</div>
                <div id="expectedVal" class="fw-bold text-dark">0</div>
            </div>
            <div class="col-4 border-end">
                <div class="unit-label">å¯¦éš›ç¾é‡‘</div>
                <div id="actualVal" class="fw-bold text-dark">0</div>
            </div>
            <div class="col-4">
                <div class="unit-label">æç›Šå·®ç•°</div>
                <div id="diffVal" class="diff-box text-danger">0</div>
            </div>
        </div>
    </div>
</div>

<script>
// è¨­å®šä»Šå¤©æ—¥æœŸ
document.getElementById('todayDate').valueAsDate = new Date();

// å¯¦æ™‚è¨ˆç®—ç›£è½
document.querySelectorAll('.calc, .sc-calc, .cash-calc, .cash-calc-manual').forEach(el => {
    el.addEventListener('input', runCalculation);
});

function runCalculation() {
    // 1. è¨ˆç®—åˆ®åˆ®æ¨‚éŠ·å”®ç¸½é¡
    let scTotal = 0;
    document.querySelectorAll('.sc-calc').forEach(el => {
        scTotal += (Number(el.value) || 0) * Number(el.dataset.price);
    });
    document.getElementById('scTotal').value = scTotal;

    // 2. æ‡‰æœ‰ç¾é‡‘é‚è¼¯
    const getV = (name) => Number(document.querySelector(`[name="${name}"]`).value) || 0;
    
    // å…¬å¼: (å°å½©æ·¨é¡) + (åˆ®åˆ®æ¨‚æ·¨é¡) + (é‹å½©æ·¨é¡) + (æœƒå“¡æ·¨é¡)
    const lottoNet = getV('lottoSales') - getV('lottoVoid') - getV('lottoPayoutIn') - getV('lottoPayoutOut');
    const scNet = scTotal - getV('scratchPayout');
    const sportNet = getV('sportSales') - getV('sportVoid') - getV('sportPayout');
    const memberNet = getV('memberIn') - getV('memberOut');
    
    const expected = lottoNet + scNet + sportNet + memberNet;

    // 3. å¯¦éš›ç¾é‡‘é‚è¼¯
    let actual = 0;
    document.querySelectorAll('.cash-calc').forEach(el => {
        actual += (Number(el.value) || 0) * Number(el.dataset.cash);
    });
    actual += Number(document.getElementById('smallChange').value) || 0;

    // 4. é¡¯ç¤ºçµæœ
    document.getElementById('expectedVal').innerText = expected.toLocaleString();
    document.getElementById('actualVal').innerText = actual.toLocaleString();
    const diff = actual - expected;
    const diffEl = document.getElementById('diffVal');
    diffEl.innerText = diff.toLocaleString();
    diffEl.style.color = diff === 0 ? "green" : "red";
}

async function submitData() {
    const scriptURL = 'æ‚¨çš„ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€'; // ğŸ‘ˆ è²¼ä¸Šæ‚¨éƒ¨ç½²å¾Œçš„ç¶²å€
    const form = document.getElementById('payForm');
    const formData = new FormData(form);
    let data = Object.fromEntries(formData.entries());

    // é¡å¤–åŠ å…¥è¨ˆç®—çµæœ
    data.expectedCash = document.getElementById('expectedVal').innerText.replace(/,/g, '');
    data.actualCash = document.getElementById('actualVal').innerText.replace(/,/g, '');
    data.diff = document.getElementById('diffVal').innerText.replace(/,/g, '');

    if(!confirm(`ç¢ºå®šé€å‡ºï¼Ÿä»Šæ—¥æç›Šå·®ç•°ç‚º: ${data.diff}`)) return;

    try {
        await fetch(scriptURL, { method: 'POST', body: JSON.stringify(data) });
        alert('ä¸Šå‚³æˆåŠŸï¼');
        location.reload();
    } catch (e) {
        alert('ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯');
    }
}
</script>
</body>
</html>

