<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投注站終極結帳系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-family: "Microsoft JhengHei", sans-serif; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .nav-pills .nav-link.active { background-color: #d9534f; }
        .btn-cash { width: 100%; margin-bottom: 10px; height: 50px; font-size: 1.1rem; }
        .summary-box { background: #e9ecef; border-radius: 10px; padding: 15px; }
        .diff-pos { color: green; font-weight: bold; }
        .diff-neg { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container py-4">
    <h2 class="text-center mb-4">🎰 彩券行打烊結帳系統</h2>

    <ul class="nav nav-pills nav-fill mb-4" id="pills-tab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab1">1.台彩/刮刮樂</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab2">2.運彩/會員</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab3">3.點鈔/支出</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab4">4.總結</button></li>
    </ul>

    <form id="closingForm">
        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab1">
                <div class="card p-3">
                    <h5>💎 台灣彩券 (電腦型)</h5>
                    <div class="row g-2">
                        <div class="col-6"><label>銷售總額</label><input type="number" name="lottoSales" class="form-control" value="0"></div>
                        <div class="col-6"><label>作廢金額</label><input type="number" name="lottoVoid" class="form-control" value="0"></div>
                        <div class="col-6"><label>店內兌獎</label><input type="number" name="lottoPayoutIn" class="form-control" value="0"></div>
                        <div class="col-6"><label>跨店兌獎</label><input type="number" name="lottoPayoutOut" class="form-control" value="0"></div>
                    </div>
                    <h5 class="mt-4">🎟️ 刮刮樂 (立即型)</h5>
                    <div class="row g-2">
                        <div class="col-6"><label>今日拆封(總面額)</label><input type="number" name="scratchLoad" class="form-control" value="0"></div>
                        <div class="col-6"><label>散張銷售</label><input type="number" name="scratchSales" class="form-control" value="0"></div>
                        <div class="col-12"><label>中獎兌付</label><input type="number" name="scratchPayout" class="form-control" value="0"></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab2">
                <div class="card p-3">
                    <h5>⚽ 運動彩券</h5>
                    <div class="row g-2">
                        <div class="col-6"><label>實體銷售</label><input type="number" name="sportSales" class="form-control" value="0"></div>
                        <div class="col-6"><label>作廢金額</label><input type="number" name="sportVoid" class="form-control" value="0"></div>
                        <div class="col-12"><label>中獎兌付</label><input type="number" name="sportPayout" class="form-control" value="0"></div>
                    </div>
                    <h5 class="mt-4">👤 會員與虛擬通路</h5>
                    <div class="row g-2">
                        <div class="col-12"><label>虛擬通路業績 (不計入現金)</label><input type="number" name="sportVirtual" class="form-control" value="0"></div>
                        <div class="col-6"><label>會員儲值(入金)</label><input type="number" name="memberIn" class="form-control" value="0"></div>
                        <div class="col-6"><label>會員出金</label><input type="number" name="memberOut" class="form-control" value="0"></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab3">
                <div class="card p-3">
                    <h5>💵 現金清點 (請輸入張數/個數)</h5>
                    <div class="row g-2">
                        <div class="col-4">2000元<input type="number" name="c2000" class="form-control cash-count" data-unit="2000" value="0"></div>
                        <div class="col-4">1000元<input type="number" name="c1000" class="form-control cash-count" data-unit="1000" value="0"></div>
                        <div class="col-4">500元<input type="number" name="c500" class="form-control cash-count" data-unit="500" value="0"></div>
                        <div class="col-4">200元<input type="number" name="c200" class="form-control cash-count" data-unit="200" value="0"></div>
                        <div class="col-4">100元<input type="number" name="c100" class="form-control cash-count" data-unit="100" value="0"></div>
                        <div class="col-4">50元<input type="number" name="m50" class="form-control cash-count" data-unit="50" value="0"></div>
                        <div class="col-4">10元<input type="number" name="m10" class="form-control cash-count" data-unit="10" value="0"></div>
                        <div class="col-4">5元<input type="number" name="m5" class="form-control cash-count" data-unit="5" value="0"></div>
                        <div class="col-4">1元<input type="number" name="m1" class="form-control cash-count" data-unit="1" value="0"></div>
                    </div>
                    <h5 class="mt-4">⚖️ 額外收支</h5>
                    <div class="row g-2">
                        <div class="col-6"><label>期初週轉金</label><input type="number" name="opening" class="form-control" value="10000"></div>
                        <div class="col-6"><label>店長提領/存行</label><input type="number" name="bankAction" class="form-control" value="0"></div>
                        <div class="col-6"><label>雜支項目</label><input type="text" name="expNote" class="form-control" placeholder="買水"></div>
                        <div class="col-6"><label>雜支金額</label><input type="number" name="expAmount" class="form-control" value="0"></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab4">
                <div class="card p-4 text-center">
                    <h4>今日結算摘要</h4>
                    <div class="summary-box mt-3">
                        <p>應有現金：<span id="showExpected">$0</span></p>
                        <p>實際現金：<span id="showActual">$0</span></p>
                        <hr>
                        <h3>損益差異：<span id="showDiff">$0</span></h3>
                    </div>
                    <div class="mt-3 text-start">
                        <label>班別</label>
                        <select name="shift" class="form-control mb-2"><option>全天班</option><option>早班</option><option>晚班</option></select>
                        <label>結帳人員</label>
                        <input type="text" name="staff" class="form-control mb-2" required>
                        <label>備註說明</label>
                        <textarea name="memo" class="form-control"></textarea>
                    </div>
                    <button type="button" onclick="sendToGoogle()" class="btn btn-danger btn-lg w-100 mt-4">確認並送出資料</button>
                </div>
            </div>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
<script>
// 自動計算邏輯
document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', calculateResult);
});

function calculateResult() {
    const f = new FormData(document.getElementById('closingForm'));
    const getNum = (name) => Number(f.get(name)) || 0;

    // 1. 計算應有現金
    // (期初) + (台彩淨銷售) + (刮刮樂銷售) + (運彩淨銷售) + (會員儲值-出金) - (雜支) - (提領)
    const lottoNet = getNum('lottoSales') - getNum('lottoVoid') - getNum('lottoPayoutIn') - getNum('lottoPayoutOut');
    const sportNet = getNum('sportSales') - getNum('sportVoid') - getNum('sportPayout');
    const memberNet = getNum('memberIn') - getNum('memberOut');
    
    const expected = getNum('opening') + lottoNet + getNum('scratchSales') - getNum('scratchPayout') + sportNet + memberNet - getNum('expAmount') - getNum('bankAction');

    // 2. 計算實際點鈔現金
    let actual = 0;
    document.querySelectorAll('.cash-count').forEach(el => {
        actual += Number(el.value) * Number(el.dataset.unit);
    });

    const diff = actual - expected;

    document.getElementById('showExpected').innerText = Math.round(expected).toLocaleString();
    document.getElementById('showActual').innerText = Math.round(actual).toLocaleString();
    document.getElementById('showDiff').innerText = Math.round(diff).toLocaleString();
    document.getElementById('showDiff').className = diff >= 0 ? 'diff-pos' : 'diff-neg';
}

function sendToGoogle() {
    const scriptURL = '您的_GAS_網頁應用程式網址'; 
    const form = document.getElementById('closingForm');
    const formData = new FormData(form);
    
    // 將所有數據封裝成 JSON
    let data = {};
    formData.forEach((value, key) => { data[key] = value; });
    
    // 加入計算後的結果
    data.expectedCash = document.getElementById('showExpected').innerText;
    data.actualCash = document.getElementById('showActual').innerText;
    data.diff = document.getElementById('showDiff').innerText;

    alert('正在上傳資料，請稍候...');
    
    fetch(scriptURL, { method: 'POST', body: JSON.stringify(data) })
    .then(res => alert('資料上傳成功！'))
    .catch(err => alert('連線失敗，請檢查網路或 API 設定'));
}
</script>
</body>
</html>

